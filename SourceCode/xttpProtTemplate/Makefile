#Makefile for xttpProtTemplate

XENOMAI_PATH=/usr/xenomai

CFLAGS_OPTIONS = -Wall -Wno-unused-but-set-variable -Wno-unused-variable 

INC_XENO = $(shell $(XENOMAI_PATH)/bin/xeno-config --skin posix --cflags)
LIB_XENO = $(shell $(XENOMAI_PATH)/bin/xeno-config --skin posix --ldflags)

#INC_XENO = $(shell $(XENOMAI_PATH)/bin/xeno-config --skin alchemy --cflags)
#LIB_XENO = $(shell $(XENOMAI_PATH)/bin/xeno-config --skin alchemy --ldflags)

INC_DIRS = $(INC_XENO)

CFLAGS   = $(CFLAGS_OPTIONS) $(INC_DIRS) -I/usr/xenomai/include/trank
LDFLAGS	 = $(LIB_XENO)
#CC := $(shell /usr/xenomai/bin/xeno-config --cc)

SOURCES = main.c
			 
CUR_DIR = ./
OBJ_DIR = obj
OUT_DIR = bin
EXEC_TARGET = xddp_echo_example_server

CC = $(CROSS_COMPILE)gcc

LD = $(CROSS_COMPILE)ld
AS = $(CROSS_COMPILE)as

#######################################################################################################
OBJECTS = $(addprefix $(OBJ_DIR)/, $(notdir $(patsubst %.c, %.o, $(patsubst %.cpp, %.o, $(SOURCES)))))
#######################################################################################################

$(OUT_DIR)/$(EXEC_TARGET): $(OBJECTS)
	@$(MKDIR) -p $(OUT_DIR); pwd > /dev/null
	$(CC) -o $(OUT_DIR)/$(EXEC_TARGET) $(OBJECTS) $(LDFLAGS)

$(OBJ_DIR)/%.o : %.cpp
	@$(MKDIR) -p $(OBJ_DIR); pwd > /dev/null
	$(CC) -MD $(CFLAGS) -c -o $@ $<

$(OBJ_DIR)/%.o : %.c
	@$(MKDIR) -p $(OBJ_DIR); pwd > /dev/null
	$(CC) -MD $(CFLAGS) -c -o $@ $<

clean:

re:
	make clean
	make -j4


.PHONY: all clean 
#######################################################################################################
# Include header file dependencies generated by -MD option:
-include $(OBJ_DIR_CUR)/*.d

